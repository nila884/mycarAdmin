import{r as A,m as F,j as e,L as H,S as M}from"./app-P_30Ywqc.js";import{H as _}from"./heading-small-CPs3tkTX.js";import{L as D,I as P}from"./label-BF5kNt9L.js";import{B as N,t as T}from"./app-logo-icon-D0-bOfxz.js";import{C as z}from"./checkbox-DGbheN4K.js";import{D as B,a as R,b as $,c as O,d as V,e as G}from"./dialog-CrpZ_p-3.js";import{S as X,a as q,b as J,c as K,d as Q}from"./select-D-h1gbiG.js";import{P as W}from"./pencil-0Fym70Ww.js";import{T as Y,f as Z,a as ee,b as v,c as p,d as se,e as x}from"./table-DwB0cqgP.js";import{A as te,X as ae}from"./app-layout-DuYsczsc.js";import{L as ie}from"./layout-BNnb3K59.js";/* empty css            */import"./index-COjtLgPO.js";import"./check-Cy2qj5ij.js";import"./heading-DeQyy-7-.js";function re(t,r,l){const c=t.name.split(" ");if(c.length===0)return{initialModuleId:"",initialActions:[]};const a=c[c.length-1],n=r.find(d=>d.name.toLowerCase()===a.toLowerCase()),C=n?n.id.toString():"",h=l.filter(d=>c.includes(d.toLowerCase()));return{initialModuleId:C,initialActions:h}}const y=({permission:t,actions:r,modules:l})=>{const[c,a]=A.useState(!1),n=!!t,C=n?`Update ${t==null?void 0:t.name}`:"Create New permission";let h,d;n?(h="permission.update",d="Update Permission"):(h="permission.store",d="Create Permission");const{data:u,setData:j,post:L,patch:E,processing:f,errors:S,reset:g}=F({module:"",actions:[]}),[I,b]=A.useState({}),U=(s,o)=>{b(w=>({...w,[s]:o}));const i=u.actions||[];let m;o&&!i.includes(s)?m=[...i,s]:!o&&i.includes(s)?m=i.filter(w=>w!==s):m=i,j("actions",m)};A.useEffect(()=>{if(n&&t&&l&&r){const{initialModuleId:s,initialActions:o}=re(t,l,r);j({module:s,actions:o,_method:"patch"});const i={};r.forEach(m=>{i[m]=o.includes(m)}),b(i)}else n||(g(),b({}))},[n,t,l,r,g,j]);const k=s=>{s.preventDefault();const o=n?{permission:t.id}:void 0;n?E(route(h,o),{onSuccess:()=>{a(!1),g()},onError:i=>{console.error("Update error:",i)}}):L(route(h),{onSuccess:()=>{g(),b({})},onError:i=>{console.error("Create error:",i)}})};return e.jsxs(B,{open:c,onOpenChange:a,children:[e.jsx(R,{asChild:!0,children:n?e.jsx(N,{variant:"ghost",size:"icon",title:`Edit ${t.name}`,children:e.jsx(W,{className:"h-4 w-4"})}):e.jsx(N,{variant:"outline",children:"Add New"})}),e.jsxs($,{className:"sm:max-w-[500px]",children:[e.jsxs(O,{children:[e.jsx(V,{children:C}),e.jsx(G,{children:n?"Modify the module and actions for this permission.":"Define a new permission by selecting a module and actions."})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(D,{htmlFor:"module",children:" Module"}),e.jsxs(X,{value:u.module,onValueChange:s=>j("module",s),disabled:f,children:[e.jsx(q,{id:"module",children:e.jsx(J,{placeholder:"Select a module"})}),e.jsx(K,{children:l==null?void 0:l.map(s=>e.jsx(Q,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(P,{message:S.module})]}),e.jsxs("div",{className:"grid grid-cols-4 justify-center gap-4 rounded-md border p-2",children:[e.jsx("div",{className:"col-span-4 mb-2 text-sm font-semibold",children:"Select Actions (CRUD)"}),r==null?void 0:r.map((s,o)=>e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(D,{htmlFor:s,className:"text-sm capitalize",children:s}),e.jsx(z,{id:s,checked:I[s]||!1,onCheckedChange:i=>{U(s,i)},disabled:f||!u.module})]},o))]}),S.actions&&e.jsx(P,{message:S.actions}),e.jsx(N,{type:"submit",disabled:f||!u.module||u.actions.length===0,className:"w-full",children:f?"Submitting...":d})]})]})]})},ne=[{title:"Permission settings",href:"/management/permission/list"}];function Se({permissions:t,actions:r,modules:l}){console.log(t);function c(a){window.confirm("Are you sure you want to delete this permission? "+a)&&M.delete(`/management/permission/${a}`,{preserveScroll:!0,onSuccess:()=>{}})}return e.jsxs(te,{breadcrumbs:ne,children:[e.jsx(H,{title:"Permission settings"}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{title:"Permission settings",description:"Add new ,Update and delete permissions name"}),e.jsx(y,{actions:r,modules:l}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Y,{className:"max-w-4xl",children:[e.jsx(Z,{children:"A list of permissions."}),e.jsx(ee,{children:e.jsxs(v,{children:[e.jsx(p,{className:"w-[100px]",children:"permission name"}),e.jsx(p,{children:" Guard name "}),e.jsx(p,{children:"Created at"}),e.jsx(p,{children:"Last update"}),e.jsx(p,{className:"text-right",children:"Action"})]})}),e.jsx(se,{children:t.data.length>0?t.data.map(a=>e.jsxs(v,{children:[e.jsx(x,{className:"font-medium",children:a.name.toUpperCase()}),e.jsx(x,{className:"font-medium",children:a.guard_name}),e.jsx(x,{children:T(a.created_at)}),e.jsx(x,{children:T(a.updated_at)}),e.jsxs(x,{className:"text-right",children:[e.jsx(y,{permission:a,actions:r,modules:l}),e.jsx(N,{className:"ml-2",size:"icon",variant:"destructive",onClick:()=>c(a.id),children:e.jsx(ae,{className:"h-4 w-4"})})]})]},a.id)):e.jsx(v,{children:e.jsx(x,{colSpan:4,className:"text-center",children:"No permission found."})})})]})})]})})]})}export{Se as default};
