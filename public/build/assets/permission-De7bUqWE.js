import{r as A,m as F,j as e,L as H,S as M}from"./app-D9b7yil5.js";import{H as _}from"./heading-small-BU4M6w1f.js";import{A as z,X as B}from"./app-layout-lUKL1h8K.js";import{L as R}from"./layout-CyRbHjtb.js";import{T as $,f as O,a as V,b as v,c as p,d as G,e as x}from"./table-DsQtr8xT.js";import{B as g,t as D}from"./app-logo-icon-BTR4zcqo.js";import{D as X,a as q,b as J,c as K,d as Q,e as W}from"./dialog-D1i5YGBp.js";import{L as T}from"./label-BjwQr2PU.js";import{I as y}from"./input-error-s3OvvhyU.js";import{S as Y,a as Z,b as ee,c as se,d as te}from"./select-p1MIQY3c.js";import{C as ae}from"./checkbox-Dsx9yR5o.js";import{P as ie}from"./pencil-CpbSHt1Z.js";/* empty css            */import"./index-CFDuspEi.js";import"./check-BcQx4ZQH.js";import"./heading-DtOTHioi.js";function re(t,r,l){const c=t.name.split(" ");if(c.length===0)return{initialModuleId:"",initialActions:[]};const a=c[c.length-1],n=r.find(d=>d.name.toLowerCase()===a.toLowerCase()),b=n?n.id.toString():"",h=l.filter(d=>c.includes(d.toLowerCase()));return{initialModuleId:b,initialActions:h}}const L=({permission:t,actions:r,modules:l})=>{const[c,a]=A.useState(!1),n=!!t,b=n?`Update ${t==null?void 0:t.name}`:"Create New permission";let h,d;n?(h="permission.update",d="Update Permission"):(h="permission.store",d="Create Permission");const{data:u,setData:N,post:P,patch:E,processing:j,errors:C,reset:S}=F({module:"",actions:[]}),[I,f]=A.useState({}),U=(s,o)=>{f(w=>({...w,[s]:o}));const i=u.actions||[];let m;o&&!i.includes(s)?m=[...i,s]:!o&&i.includes(s)?m=i.filter(w=>w!==s):m=i,N("actions",m)};A.useEffect(()=>{if(n&&t&&l&&r){const{initialModuleId:s,initialActions:o}=re(t,l,r);N({module:s,actions:o,_method:"patch"});const i={};r.forEach(m=>{i[m]=o.includes(m)}),f(i)}else n||(S(),f({}))},[n,t,l,r]);const k=s=>{s.preventDefault();const o=n?{permission:t.id}:void 0;n?E(route(h,o),{onSuccess:()=>{a(!1),S()},onError:i=>{console.error("Update error:",i)}}):P(route(h),{onSuccess:()=>{S(),f({})},onError:i=>{console.error("Create error:",i)}})};return e.jsxs(X,{open:c,onOpenChange:a,children:[e.jsx(q,{asChild:!0,children:n?e.jsx(g,{variant:"ghost",size:"icon",title:`Edit ${t.name}`,children:e.jsx(ie,{className:"h-4 w-4"})}):e.jsx(g,{variant:"outline",children:"Add New"})}),e.jsxs(J,{className:"sm:max-w-[500px]",children:[e.jsxs(K,{children:[e.jsx(Q,{children:b}),e.jsx(W,{children:n?"Modify the module and actions for this permission.":"Define a new permission by selecting a module and actions."})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"module",children:" Module"}),e.jsxs(Y,{value:u.module,onValueChange:s=>N("module",s),disabled:j,children:[e.jsx(Z,{id:"module",children:e.jsx(ee,{placeholder:"Select a module"})}),e.jsx(se,{children:l==null?void 0:l.map(s=>e.jsx(te,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(y,{message:C.module})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 justify-center p-2 border rounded-md",children:[e.jsx("div",{className:"col-span-4 text-sm font-semibold mb-2",children:"Select Actions (CRUD)"}),r==null?void 0:r.map((s,o)=>e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(T,{htmlFor:s,className:"capitalize text-sm",children:s}),e.jsx(ae,{id:s,checked:I[s]||!1,onCheckedChange:i=>{U(s,i)},disabled:j||!u.module})]},o))]}),C.actions&&e.jsx(y,{message:C.actions}),e.jsx(g,{type:"submit",disabled:j||!u.module||u.actions.length===0,className:"w-full",children:j?"Submitting...":d})]})]})]})},ne=[{title:"Permission settings",href:"/management/permission/list"}];function we({permissions:t,actions:r,modules:l}){console.log(t);function c(a){window.confirm("Are you sure you want to delete this permission? "+a)&&M.delete(`/management/permission/${a}`,{preserveScroll:!0,onSuccess:()=>{}})}return e.jsxs(z,{breadcrumbs:ne,children:[e.jsx(H,{title:"Permission settings"}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{title:"Permission settings",description:"Add new ,Update and delete permissions name"}),e.jsx(L,{actions:r,modules:l}),e.jsx("div",{className:"rounded-md border",children:e.jsxs($,{className:" max-w-4xl",children:[e.jsx(O,{children:"A list of permissions."}),e.jsx(V,{children:e.jsxs(v,{children:[e.jsx(p,{className:"w-[100px]",children:"permission name"}),e.jsx(p,{children:" Guard name "}),e.jsx(p,{children:"Created at"}),e.jsx(p,{children:"Last update"}),e.jsx(p,{className:"text-right",children:"Action"})]})}),e.jsx(G,{children:t.data.length>0?t.data.map(a=>e.jsxs(v,{children:[e.jsx(x,{className:"font-medium",children:a.name.toUpperCase()}),e.jsx(x,{className:"font-medium",children:a.guard_name}),e.jsx(x,{children:D(a.created_at)}),e.jsx(x,{children:D(a.updated_at)}),e.jsxs(x,{className:"text-right",children:[e.jsx(L,{permission:a,actions:r,modules:l}),e.jsx(g,{className:"ml-2",size:"icon",variant:"destructive",onClick:()=>c(a.id),children:e.jsx(B,{className:"h-4 w-4"})})]})]},a.id)):e.jsx(v,{children:e.jsx(x,{colSpan:4,className:"text-center",children:"No permission found."})})})]})})]})})]})}export{we as default};
